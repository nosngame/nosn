<html lang="en">
<head>
	<meta charset="utf-8">
	<title>FBGame服务器后台</title>
    <link rel="shortcut icon" href="http://112.126.81.165/favicon.ico" /> 
	<link rel="stylesheet" href="http://112.126.81.165/style.css" media="screen">
	<link rel="stylesheet" href="http://112.126.81.165/dijit/themes/claro/claro.css" media="screen">
</head>
<body id="mainpage" class="claro">
    <div id="appLayout" class="demoLayout" data-dojo-type="dijit/layout/BorderContainer" data-dojo-props="design: 'headline'">
	    <div id="centerLayout" class="centerPanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'center'">
            <div id="viewcontainer"></div>
	    </div>
	    <div class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'top'"><h1>FBGame 服务器后台管理平台</h1></div>
	    <div id="leftCol" class="edgePanel" data-dojo-type="dijit/layout/ContentPane" data-dojo-props="region: 'left', splitter: true">
            <button id="usermanager"></button><br>
            <button id="online"></button><br>
            <button id="charge"></button><br>
            <button id="operation"></button><br>
            <button id="remain"></button><br>
            <button id="networkflow"></button><br>
	    </div>
    </div>
    <!-- load dojo -->
    <script id="viewcode"></script>
    <script src="http://112.126.81.165/dojo/dojo.js"></script>
    <script>
        var userLevel = %d;
        var token = "%s";
        var addUserDialog = null;
        var modifyUserDialog = null;
        var modifyPasswordDialog = null;
        function operCommand(urlApi) {
            // Look up the node we'll stick the text under.  
            var mainPage = document.getElementById("mainpage");

            // remove viewcode node
            var targetNode = dojo.byId("viewcode");
            if (targetNode != null)
                mainPage.removeChild(targetNode);

            targetNode = document.createElement("script");
            targetNode.setAttribute("id", "viewcode");
            mainPage.appendChild(targetNode);

            var viewContainer = document.getElementById("viewcontainer");
            if (viewContainer != null) {
                var centerLayout = document.getElementById("centerLayout");
                centerLayout.removeChild(viewContainer);

                viewContainer = document.createElement("viewcontainer");
                viewContainer.setAttribute("id", "viewcontainer");
                centerLayout.appendChild(viewContainer);
            }

            // The parameters to pass to xhrGet, the url, how to handle it, and the callbacks.  
            var xhrArgs = {
                url: urlApi,
                handleAs: "text",
                load: function (data) {
                    targetNode.innerHTML = data;
                },
                error: function (error) {
                    targetNode.innerHTML = "console.log(" + "An unexpected error occurred: " + error + ")";
                }
            }

            // Call the asynchronous xhrGet  
            var deferred = dojo.xhrGet(xhrArgs);
        }

        require(["dojo/parser", "dijit/form/Button", "dijit/layout/BorderContainer", "dijit/layout/ContentPane", "dojo/domReady!"], function (parser, Button) {
            if ( userLevel == 0 || userLevel == 1 )
            {
                var buttonUser = new Button({
                    label: "用户管理",
                    onClick: function () { operCommand("/(FBGameUserManager:" + token + ")"); }
                }, "usermanager");
                buttonUser.startup();
            }

            var buttonOnline = new Button({
                label: "实时在线人数",
                onClick: function () { operCommand("/(FBGameOnLineCounter:" + token + ":0:)"); }
            }, "online");
            buttonOnline.startup();

            var buttonCharge = new Button({
                label: "充值收入数据",
                onClick: function () {
                    var date = new Date();
                    var year = date.getFullYear();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    operCommand("/(FBGameCharge:" + token + ":0::" + year + ":" + month + ":" + day + ":" + 7 + ")");
                }
            }, "charge");
            buttonCharge.startup();

            var buttonUser = new Button({
                label: "游戏用户指标",
                onClick: function ()
                {
                    var date    = new Date( );
                    var year    = date.getFullYear( );
                    var month   = date.getMonth( ) + 1;
                    var day     = date.getDate( );
                    operCommand("/(FBGameOperation:" + token + ":0::" + year + ":" + month + ":" + day + ":" + 7 + ")");
                }
            }, "operation");
            buttonUser.startup();

            var buttonRemain = new Button({
                label: "游戏留存指标",
                onClick: function () {
                    var date = new Date( );
                    var year = date.getFullYear();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    operCommand("/(FBGameRemain:" + token + ":0::" + year + ":" + month + ":" + day + ":" + 7 + ")");
                }
            }, "remain");
            buttonRemain.startup();

            var buttonFlow = new Button({
                label: "外网流量消耗",
                onClick: function () { operCommand("/(FBGameNetworkFlow:" + token + ":1000)"); }
            }, "networkflow");
            buttonFlow.startup();
            parser.parse();
        });
    </script>
</body>
</html>